{"ast":null,"code":"var _jsxFileName = \"/Users/colepatton/vibin/src/components/Post.js\";\nimport React, { Component } from 'react';\nimport profilePicturePlaceholder from '../img/profilePicturePlaceholder.jpg';\nimport '../style/App.css';\nimport queryString from 'query-string';\nimport { getTrack, playAt, pause, getUser } from '../spotifyCalls';\nimport { useHistory, Link } from 'react-router-dom';\nimport { loadLikes, likePost, deleteLike } from '../backendCalls';\n\nclass PostMusic extends Component {\n  constructor(props) {\n    super(props);\n\n    this.routeToSpotify = () => {\n      const history = useHistory();\n      history.push('https://open.spotify.com/track/' + this.props.songId);\n    };\n\n    this.loadTrack = async () => {\n      const trackData = await getTrack(this.props.accessToken, this.props.songId);\n      const albumCover = trackData.album.images[0].url;\n      this.setState({\n        picLoaded: true,\n        albumUrl: albumCover,\n        songName: this.props.songName\n      });\n    };\n\n    this.state = {\n      picLoaded: false,\n      albumUrl: '',\n      songName: ''\n    };\n    this.routeToSpotify = this.routeToSpotify.bind(this);\n  }\n\n  render() {\n    let songName = this.props.songName;\n    let songArtist = this.props.songArtist;\n\n    if (this.props.loggedIn && this.state.songName != this.props.songName || this.props.loggedIn && !this.state.picLoaded) {\n      this.loadTrack();\n    }\n\n    return /*#__PURE__*/React.createElement(\"div\", {\n      className: \"postMusic\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 39,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(\"img\", {\n      className: \"albumImg\",\n      onClick: event => window.location.href = 'https://open.spotify.com/track/' + this.props.songId,\n      src: this.state.picLoaded ? this.state.albumUrl : profilePicturePlaceholder,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 40,\n        columnNumber: 17\n      }\n    }), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"songCredit\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 44,\n        columnNumber: 17\n      }\n    }, /*#__PURE__*/React.createElement(\"h4\", {\n      className: \"songName\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 45,\n        columnNumber: 21\n      }\n    }, songName), /*#__PURE__*/React.createElement(\"p\", {\n      className: \"artists\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 46,\n        columnNumber: 21\n      }\n    }, songArtist)));\n  }\n\n}\n\nexport default class Post extends Component {\n  constructor(props) {\n    super(props);\n\n    this.pauseSong = async startTime => {\n      pause(this.props.accessToken);\n      this.stopTimer(startTime);\n    };\n\n    this.playSong = async (songId, startTime, endTime) => {\n      playAt(this.props.deviceId, this.props.accessToken, songId, startTime);\n      clearInterval(this.timer);\n      this.timer = '';\n      this.startTimer(startTime, endTime);\n    };\n\n    this.startTimer = async (startTime, endTime) => {\n      this.setState({\n        time: startTime,\n        start: Date.now() - startTime\n      });\n\n      if (!this.timer) {\n        this.timer = setInterval(() => {\n          this.setState({\n            time: Math.floor(Date.now() - this.state.start)\n          });\n\n          if (this.state.time > endTime) {\n            this.pauseSong(startTime);\n          }\n        }, 1000);\n      }\n    };\n\n    this.stopTimer = async startTime => {\n      this.setState({\n        time: startTime\n      });\n      clearInterval(this.timer);\n      this.timer = '';\n    };\n\n    this.handleMouseHover = this.handleMouseHover.bind(this);\n    this.handleMouseLeave = this.handleMouseLeave.bind(this);\n    this.clickedLikePost = this.clickedLikePost.bind(this);\n    this.state = {\n      playing: false,\n      time: 0,\n      start: 0,\n      accessToken: '',\n      likeCount: '',\n      liked: false,\n      muted: false\n    };\n  }\n\n  componentDidMount() {\n    let liked = false;\n    loadLikes().then(likes => {\n      likes.forEach(like => {\n        if (like.postId === this.props.post._id && like.username === this.props.username) {\n          liked = true;\n        }\n      });\n    }).then(() => {\n      this.setState({\n        accessToken: this.props.accessToken,\n        likeCount: this.props.post.likeCount,\n        liked: liked,\n        muted: this.props.muted\n      });\n    });\n  }\n\n  componentDidUpdate(prevProps) {\n    if (this.props.accessToken != prevProps.accessToken) this.setState({\n      accessToken: this.props.accessToken\n    });\n    if (this.props.muted != prevProps.muted) this.setState({\n      muted: this.props.muted\n    });\n  }\n\n  handleMouseHover() {\n    if (!this.state.muted) this.playSong(this.props.post.songId, this.props.post.startTime, this.props.post.stopTime);\n  }\n\n  handleMouseLeave() {\n    if (!this.state.muted) setTimeout(() => {\n      this.pauseSong(this.props.post.startTime);\n    }, 100);\n  }\n\n  clickedLikePost() {\n    if (!this.state.liked) {\n      likePost(this.props.username, this.props.post._id);\n      this.setState({\n        likeCount: this.state.likeCount + 1,\n        liked: true\n      });\n    } else {\n      deleteLike(this.props.username, this.props.post._id);\n      this.setState({\n        likeCount: this.state.likeCount - 1,\n        liked: false\n      });\n    }\n  }\n\n  render() {\n    let post = this.props.post; // console.log(\"ASDFADFADFS\");\n    // console.log(this.props.accessToken);\n    // const access_token = this.props.accessToken;\n    // console.log(access_token);\n\n    if (this.state.accessToken) {\n      console.log(\"HERE HERRE HERE\");\n      return /*#__PURE__*/React.createElement(\"div\", {\n        className: \"post\",\n        onMouseEnter: this.handleMouseHover,\n        onMouseLeave: this.handleMouseLeave,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 153,\n          columnNumber: 17\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"postInner\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 154,\n          columnNumber: 21\n        }\n      }, /*#__PURE__*/React.createElement(PostInfo, {\n        access_tokenn: this.state.accessToken,\n        name: post.name,\n        text: post.text,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 155,\n          columnNumber: 25\n        }\n      }), /*#__PURE__*/React.createElement(PostMusic, {\n        songName: post.songName,\n        songArtist: post.songArtist,\n        songId: post.songId,\n        loggedIn: true,\n        accessToken: this.props.accessToken,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 156,\n          columnNumber: 25\n        }\n      })), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"likeButtonContainer\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 158,\n          columnNumber: 21\n        }\n      }, /*#__PURE__*/React.createElement(\"button\", {\n        className: \"likeButton myButtonBlue\",\n        onClick: this.clickedLikePost,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 159,\n          columnNumber: 25\n        }\n      }, this.state.liked ? 'Liked' : 'Like'), /*#__PURE__*/React.createElement(\"p\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 162,\n          columnNumber: 25\n        }\n      }, this.state.likeCount)));\n    } else {\n      return /*#__PURE__*/React.createElement(\"div\", {\n        className: \"post\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 168,\n          columnNumber: 17\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"postInner\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 169,\n          columnNumber: 21\n        }\n      }, /*#__PURE__*/React.createElement(PostInfo, {\n        name: post.name,\n        text: post.text,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 170,\n          columnNumber: 25\n        }\n      }), /*#__PURE__*/React.createElement(PostMusic, {\n        songName: post.songName,\n        songArtist: post.songArtist,\n        songId: post.songId,\n        loggedIn: false,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 171,\n          columnNumber: 25\n        }\n      })), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"likeButtonContainer\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 173,\n          columnNumber: 21\n        }\n      }, /*#__PURE__*/React.createElement(\"button\", {\n        className: \"likeButton myButtonBlue\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 174,\n          columnNumber: 25\n        }\n      }, \"Like\"), /*#__PURE__*/React.createElement(\"p\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 175,\n          columnNumber: 25\n        }\n      }, this.state.likeCount)));\n    }\n  }\n\n}\n\nclass PostInfo extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      imgUrl: ''\n    };\n    this.redirectToUserProfile = this.redirectToUserProfile.bind(this);\n  }\n\n  componentDidMount() {\n    console.log('this.props.access_tokenn');\n    console.log(this.props.access_tokenn);\n    let parsed = queryString.parse(window.location.search);\n    let accessToken = '';\n\n    if (parsed.access_token) {\n      accessToken = parsed.access_token; // console.log('access token');\n      // console.log(this.props.access_tokenn);\n\n      getUser(this.props.access_tokenn, this.props.name).then(user => {\n        let imgUrl = user.images.length > 0 ? user.images[0].url : '';\n        console.log('imgUrl');\n        console.log(user);\n        this.setState({\n          imgUrl: imgUrl\n        });\n      });\n    }\n  }\n\n  redirectToUserProfile() {\n    let parsed = queryString.parse(window.location.search);\n    let accessToken = '';\n    if (parsed.access_token) accessToken = parsed.access_token;\n    window.location.href = window.location.origin + '/user/?username=' + this.props.name + (accessToken ? '&access_token=' + accessToken : '');\n  }\n\n  render() {\n    let name = this.props.name;\n    let text = this.props.text;\n    return /*#__PURE__*/React.createElement(\"div\", {\n      className: \"postInfo\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 223,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(\"img\", {\n      className: \"profilePic\",\n      src: this.state.imgUrl ? this.state.imgUrl : profilePicturePlaceholder,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 224,\n        columnNumber: 17\n      }\n    }), /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 225,\n        columnNumber: 17\n      }\n    }, /*#__PURE__*/React.createElement(\"h3\", {\n      className: \"username\",\n      onClick: this.redirectToUserProfile,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 226,\n        columnNumber: 21\n      }\n    }, name), /*#__PURE__*/React.createElement(\"p\", {\n      className: \"postText\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 227,\n        columnNumber: 21\n      }\n    }, text)));\n  }\n\n}","map":{"version":3,"sources":["/Users/colepatton/vibin/src/components/Post.js"],"names":["React","Component","profilePicturePlaceholder","queryString","getTrack","playAt","pause","getUser","useHistory","Link","loadLikes","likePost","deleteLike","PostMusic","constructor","props","routeToSpotify","history","push","songId","loadTrack","trackData","accessToken","albumCover","album","images","url","setState","picLoaded","albumUrl","songName","state","bind","render","songArtist","loggedIn","event","window","location","href","Post","pauseSong","startTime","stopTimer","playSong","endTime","deviceId","clearInterval","timer","startTimer","time","start","Date","now","setInterval","Math","floor","handleMouseHover","handleMouseLeave","clickedLikePost","playing","likeCount","liked","muted","componentDidMount","then","likes","forEach","like","postId","post","_id","username","componentDidUpdate","prevProps","stopTime","setTimeout","console","log","name","text","PostInfo","imgUrl","redirectToUserProfile","access_tokenn","parsed","parse","search","access_token","user","length","origin"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport profilePicturePlaceholder from '../img/profilePicturePlaceholder.jpg';\nimport '../style/App.css';\nimport queryString from 'query-string';\nimport { getTrack, playAt, pause, getUser } from '../spotifyCalls';\nimport { useHistory, Link } from 'react-router-dom';\nimport { loadLikes, likePost, deleteLike } from '../backendCalls';\n\nclass PostMusic extends Component {\n    constructor(props) {\n        super(props);\n        this.state = {\n            picLoaded: false,\n            albumUrl: '',\n            songName: ''\n        };\n        this.routeToSpotify = this.routeToSpotify.bind(this);\n    }\n    routeToSpotify = () => {\n        const history = useHistory();\n        history.push('https://open.spotify.com/track/' + this.props.songId);\n    }\n    loadTrack = async () => {\n        const trackData = await getTrack(this.props.accessToken, this.props.songId);\n        const albumCover = trackData.album.images[0].url;\n        this.setState({\n            picLoaded: true,\n            albumUrl: albumCover,\n            songName: this.props.songName\n        });\n    }\n    render() {\n        let songName = this.props.songName;\n        let songArtist = this.props.songArtist;\n        if ((this.props.loggedIn && (this.state.songName != this.props.songName)) || (this.props.loggedIn && !this.state.picLoaded)) {\n            this.loadTrack();\n        }\n        return (\n            <div className=\"postMusic\">\n                <img className=\"albumImg\"\n                    onClick={event => window.location.href = 'https://open.spotify.com/track/' + this.props.songId}\n                    src={this.state.picLoaded ? this.state.albumUrl : profilePicturePlaceholder}>\n                </img>\n                <div className=\"songCredit\">\n                    <h4 className=\"songName\">{songName}</h4>\n                    <p className=\"artists\">{songArtist}</p>\n                </div>\n            </div>\n        );\n    }\n}\n\nexport default class Post extends Component {\n    constructor(props) {\n        super(props);\n        this.handleMouseHover = this.handleMouseHover.bind(this);\n        this.handleMouseLeave = this.handleMouseLeave.bind(this);\n        this.clickedLikePost = this.clickedLikePost.bind(this);\n        this.state = {\n            playing: false,\n            time: 0,\n            start: 0,\n            accessToken: '',\n            likeCount: '',\n            liked: false,\n            muted: false\n        };\n    }\n    componentDidMount() {\n        let liked = false;\n        loadLikes().then(likes => {\n            likes.forEach(like => {\n                if (like.postId === this.props.post._id && like.username === this.props.username) {\n                    liked = true;\n                }\n            });\n        }).then(() => {\n            this.setState({\n                accessToken: this.props.accessToken,\n                likeCount: this.props.post.likeCount,\n                liked: liked,\n                muted: this.props.muted\n            });\n        })\n    }\n    componentDidUpdate(prevProps) {\n        if (this.props.accessToken != prevProps.accessToken)\n            this.setState({ accessToken: this.props.accessToken });\n        if (this.props.muted != prevProps.muted)\n            this.setState({ muted: this.props.muted });\n    }\n    pauseSong = async (startTime) => {\n        pause(this.props.accessToken)\n        this.stopTimer(startTime);\n    }\n    playSong = async (songId, startTime, endTime) => {\n        playAt(this.props.deviceId, this.props.accessToken, songId, startTime);\n        clearInterval(this.timer);\n        this.timer = '';\n        this.startTimer(startTime, endTime);\n    }\n    startTimer = async (startTime, endTime) => {\n        this.setState({\n            time: startTime,\n            start: Date.now() - startTime\n        });\n        if (!this.timer) {\n            this.timer = setInterval(() => {\n                this.setState({\n                    time: Math.floor(Date.now() - this.state.start),\n                });\n                if (this.state.time > endTime) {\n                    this.pauseSong(startTime);\n                }\n            }, 1000);\n        }\n    }\n    stopTimer = async (startTime) => {\n        this.setState({\n            time: startTime,\n        });\n        clearInterval(this.timer);\n        this.timer = '';\n    }\n    handleMouseHover() {\n        if (!this.state.muted)\n            this.playSong(this.props.post.songId, this.props.post.startTime, this.props.post.stopTime);\n    }\n    handleMouseLeave() {\n        if (!this.state.muted)\n            setTimeout((() => {\n                this.pauseSong(this.props.post.startTime);\n            }), 100);\n    }\n    clickedLikePost() {\n        if (!this.state.liked) {\n            likePost(this.props.username, this.props.post._id);\n            this.setState({ likeCount: (this.state.likeCount + 1), liked: true });\n        } else {\n            deleteLike(this.props.username, this.props.post._id);\n            this.setState({ likeCount: (this.state.likeCount - 1), liked: false });\n        }\n    }\n    render() {\n        let post = this.props.post;\n        // console.log(\"ASDFADFADFS\");\n        // console.log(this.props.accessToken);\n        // const access_token = this.props.accessToken;\n        // console.log(access_token);\n        if (this.state.accessToken) {\n            console.log(\"HERE HERRE HERE\");\n            return (\n                <div className=\"post\" onMouseEnter={this.handleMouseHover} onMouseLeave={this.handleMouseLeave}>\n                    <div className=\"postInner\">\n                        <PostInfo access_tokenn={this.state.accessToken} name={post.name} text={post.text} />\n                        <PostMusic songName={post.songName} songArtist={post.songArtist} songId={post.songId} loggedIn={true} accessToken={this.props.accessToken} />\n                    </div>\n                    <div className='likeButtonContainer'>\n                        <button className='likeButton myButtonBlue' onClick={this.clickedLikePost}>\n                            {this.state.liked ? 'Liked' : 'Like'}\n                        </button>\n                        <p>{this.state.likeCount}</p>\n                    </div>\n                </div>\n            );\n        } else {\n            return (\n                <div className=\"post\">\n                    <div className='postInner'>\n                        <PostInfo name={post.name} text={post.text} />\n                        <PostMusic songName={post.songName} songArtist={post.songArtist} songId={post.songId} loggedIn={false} />\n                    </div>\n                    <div className='likeButtonContainer'>\n                        <button className='likeButton myButtonBlue'>Like</button>\n                        <p>{this.state.likeCount}</p>\n                    </div>\n                </div>\n            );\n        }\n    }\n}\n\nclass PostInfo extends Component {\n    constructor(props) {\n        super(props);\n        this.state = {\n            imgUrl: ''\n        };\n        this.redirectToUserProfile = this.redirectToUserProfile.bind(this);\n    }\n    componentDidMount() {\n        console.log('this.props.access_tokenn');\n        console.log(this.props.access_tokenn);\n        let parsed = queryString.parse(window.location.search);\n        let accessToken = ''\n        if (parsed.access_token) {\n            accessToken = parsed.access_token;\n            // console.log('access token');\n            // console.log(this.props.access_tokenn);\n            getUser(this.props.access_tokenn, this.props.name).then(user => {\n                let imgUrl = user.images.length > 0 ?\n                    user.images[0].url : '';\n                console.log('imgUrl');\n                console.log(user);\n                this.setState({\n                    imgUrl: imgUrl\n                })\n            })\n        }\n    }\n    redirectToUserProfile() {\n        let parsed = queryString.parse(window.location.search);\n        let accessToken = ''\n        if (parsed.access_token)\n            accessToken = parsed.access_token;\n\n        window.location.href = window.location.origin + '/user/?username=' + this.props.name + (accessToken ? ('&access_token=' + accessToken) : '');\n    }\n    render() {\n        let name = this.props.name;\n        let text = this.props.text;\n        return (\n            <div className=\"postInfo\">\n                <img className=\"profilePic\" src={this.state.imgUrl ? this.state.imgUrl : profilePicturePlaceholder}></img>\n                <div>\n                    <h3 className=\"username\" onClick={this.redirectToUserProfile}>{name}</h3>\n                    <p className=\"postText\">{text}</p>\n                </div>\n            </div>\n        );\n    }\n}\n"]},"metadata":{},"sourceType":"module"}