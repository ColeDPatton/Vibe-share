{"ast":null,"code":"var _jsxFileName = \"/Users/colepatton/Vibe-share/src/pages/UserProfile.js\";\nimport React, { Component } from 'react';\nimport queryString from 'query-string';\nimport '../style/App.css';\nimport { loadPosts, loadLikes, loadUserFollowing, followUser, unFollowUser, newUser } from '../backendCalls';\nimport { getLoggedInUser, getUser } from '../spotifyCalls';\nimport Post from '../components/Post';\nimport profilePicturePlaceholder from '../img/profilePicturePlaceholder.jpg';\nimport ProfilePageHeader from '../components/ProfilePageHeader';\nimport NewPost from '../components/NewPost';\n\nclass UserProfile extends Component {\n  constructor() {\n    super();\n\n    this.handlePlayerStatus = async device_id => {\n      this.setState({\n        deviceId: device_id\n      });\n    };\n\n    this.initializePlayer = () => {\n      const name = this.state.serverData.user.name + ' vibes';\n      this.player = new window.Spotify.Player({\n        getOAuthToken: cb => {\n          cb(this.state.accessToken);\n        },\n        name\n      });\n      this.player.addListener('initialization_error', ({\n        message\n      }) => {\n        console.error(message);\n      });\n      this.player.addListener('authentication_error', ({\n        message\n      }) => {\n        console.error(message);\n      });\n      this.player.addListener('account_error', ({\n        message\n      }) => {\n        console.error(message);\n      });\n      this.player.addListener('playback_error', ({\n        message\n      }) => {\n        console.error(message);\n      }); // Playback status updates\n\n      this.player.addListener('player_state_changed', state => {\n        console.log(state);\n      }); // Ready\n\n      this.player.addListener('ready', ({\n        device_id\n      }) => {\n        this.handlePlayerStatus(device_id);\n        console.log('Ready with Device ID', device_id);\n      }); // Not Ready\n\n      this.player.addListener('not_ready', ({\n        device_id\n      }) => {\n        console.log('Device ID has gone offline', device_id);\n      });\n      this.player.connect();\n    };\n\n    this.state = {\n      deviceId: '',\n      accessToken: '',\n      profilePageUsername: '',\n      serverData: {},\n      muted: true,\n      followers: [],\n      following: [],\n      loggedInUserFollowingProfileUser: false,\n      profilePicY: '',\n      newPost: false\n    };\n    this.clickFollowButton = this.clickFollowButton.bind(this);\n    this.followUser = this.followUser.bind(this);\n    this.unfollowUser = this.unfollowUser.bind(this);\n    this.redirectToHomePage = this.redirectToHomePage.bind(this);\n    this.handleMuteButton = this.handleMuteButton.bind(this);\n    this.clickNewPost = this.clickNewPost.bind(this);\n    this.clickOuterNewPost = this.clickOuterNewPost.bind(this);\n  }\n\n  componentDidMount() {\n    let parsed = queryString.parse(window.location.search);\n    let profilePageUsernameFromUrl = parsed.username;\n    let profilePageIDFromUrl = parsed.userId;\n    let postsForProfile = [];\n\n    if (parsed.access_token) {\n      let accessToken = parsed.access_token;\n      getUser(accessToken, profilePageIDFromUrl).then(user => {\n        let imgUrl = user.images && user.images.length > 0 ? user.images[0].url : '';\n        this.setState({\n          imgUrl: imgUrl\n        });\n      });\n      getLoggedInUser(accessToken).then(user => {\n        let postProfilePic = user.images && user.images.length > 0 ? user.images[0].url : '';\n        loadUserFollowing(user.display_name).then(userFollowing => {\n          if (!Object.keys(userFollowing).length) {\n            newUser(user.id, user.display_name);\n          }\n        });\n        loadUserFollowing(profilePageIDFromUrl).then(profilePageUser => {\n          let loggedInUserFollowingProfileUser = profilePageUser.followers && profilePageUser.followers.filter(f => f.username === user.display_name && f.userId === user.id).length > 0;\n          this.setState({\n            followers: profilePageUser.followers,\n            following: profilePageUser.following,\n            loggedInUserFollowingProfileUser: loggedInUserFollowingProfileUser,\n            profilePicY: profilePageUser.profilePicY\n          });\n        });\n        loadPosts().then(posts => {\n          loadLikes().then(likes => {\n            posts.forEach(post => {\n              let likedByProfilePageUser = false;\n              let likeCount = 0;\n\n              if (post.username === profilePageUsernameFromUrl) {\n                likes.forEach(like => {\n                  if (post._id === like.postId) {\n                    likeCount++;\n                  }\n                });\n                post = { ...post,\n                  likedByProfilePageUser: likedByProfilePageUser,\n                  likeCount: likeCount\n                };\n                postsForProfile.push(post);\n              } else {\n                likes.forEach(like => {\n                  if (post._id === like.postId) {\n                    likeCount++;\n\n                    if (like.username === profilePageUsernameFromUrl) {\n                      post = { ...post,\n                        likedByProfilePageUser: true,\n                        likeCount: likeCount\n                      };\n                      postsForProfile.push(post);\n                    }\n                  }\n                });\n              }\n            });\n            this.setState({\n              accessToken: accessToken,\n              serverData: {\n                posts: postsForProfile,\n                user: {\n                  name: user.display_name,\n                  product: user.product,\n                  id: user.id,\n                  profilePic: postProfilePic\n                }\n              },\n              profilePageUsername: profilePageUsernameFromUrl,\n              profilePageId: profilePageIDFromUrl\n            });\n          }).then(window.onSpotifyWebPlaybackSDKReady = this.initializePlayer);\n        });\n      });\n    } else {\n      loadUserFollowing(profilePageIDFromUrl).then(user => {\n        this.setState({\n          followers: user.followers,\n          following: user.following,\n          profilePicY: user.profilePicY\n        });\n      });\n      loadPosts().then(posts => {\n        loadLikes().then(likes => {\n          posts.forEach(post => {\n            let likeCount = 0;\n\n            if (post.username === profilePageUsernameFromUrl) {\n              likes.forEach(like => {\n                if (post._id === like.postId) {\n                  likeCount++;\n                }\n              });\n              post = { ...post,\n                likedByProfilePageUser: false,\n                likeCount: likeCount\n              };\n              postsForProfile.push(post);\n            } else {\n              likes.forEach(like => {\n                if (post._id === like.postId) {\n                  likeCount++;\n\n                  if (like.username === profilePageUsernameFromUrl) {\n                    post = { ...post,\n                      likedByProfilePageUser: true,\n                      likeCount: likeCount\n                    };\n                    postsForProfile.push(post);\n                  }\n                }\n              });\n            }\n          });\n          this.setState({\n            serverData: {\n              posts: postsForProfile\n            },\n            profilePageUsername: profilePageUsernameFromUrl,\n            profilePageId: profilePageIDFromUrl\n          });\n        });\n      });\n    }\n  }\n\n  unfollowUser() {\n    unFollowUser(this.state.serverData.user.name, this.state.serverData.user.id, this.state.profilePageUsername, this.state.profilePageId);\n    const updatedFollowerList = this.state.followers;\n    const deleteIndex = updatedFollowerList.findIndex(x => x === this.state.serverData.user.id);\n    updatedFollowerList.splice(deleteIndex, 1);\n    this.setState({\n      followers: updatedFollowerList,\n      loggedInUserFollowingProfileUser: false\n    });\n  }\n\n  followUser() {\n    followUser(this.state.serverData.user.name, this.state.serverData.user.id, this.state.profilePageUsername, this.state.profilePageId);\n    const updatedFollowerList = this.state.followers;\n    updatedFollowerList.push({\n      userId: this.state.serverData.user.id,\n      username: this.state.serverData.user.name\n    });\n    this.setState({\n      followers: updatedFollowerList,\n      loggedInUserFollowingProfileUser: true\n    });\n  }\n\n  clickFollowButton() {\n    this.state.loggedInUserFollowingProfileUser ? this.unfollowUser() : this.followUser();\n  }\n\n  redirectToHomePage() {\n    window.location.href = window.location.origin + (this.state.accessToken ? '?access_token=' + this.state.accessToken : '');\n  }\n\n  handleMuteButton() {\n    this.setState({\n      muted: !this.state.muted\n    });\n  }\n\n  clickNewPost() {\n    const showPost = this.state.newPost;\n    this.setState({\n      newPost: !showPost\n    });\n  }\n\n  clickOuterNewPost() {\n    const showPost = this.state.newPost;\n    this.setState({\n      newPost: !showPost\n    });\n  }\n\n  async submitNewPost(text, songId, songName, songArtist, songArt, startTime, stopTime) {\n    const profilePic = this.state.imgUrl;\n    const username = this.state.serverData.user.name;\n    const userId = this.state.serverData.user.id;\n    const newPost = await submitPost(profilePic, username, userId, text, songId, songName, songArtist, songArt, startTime, stopTime);\n    const updatedPosts = this.state.serverData.posts;\n    updatedPosts.unshift(newPost);\n    this.setState({\n      serverData: {\n        posts: updatedPosts,\n        user: this.state.serverData.user\n      },\n      newPost: false\n    });\n  }\n\n  render() {\n    let allPosts = this.state.serverData.posts ? this.state.serverData.posts : [];\n    let followers = this.state.followers ? this.state.followers : [];\n    let following = this.state.following ? this.state.following : [];\n    let name = this.state.serverData.user ? this.state.serverData.user.name : 'Not logged in';\n    let userId = this.state.serverData.user ? this.state.serverData.user.id : '';\n    return /*#__PURE__*/React.createElement(\"div\", {\n      className: \"App\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 289,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(ProfilePageHeader, {\n      username: name,\n      userId: userId,\n      handleMuteButton: this.handleMuteButton,\n      muted: this.state.muted,\n      profilePic: this.state.imgUrl,\n      profilePicY: this.state.profilePicY,\n      profilePageId: this.state.profilePageId,\n      loggedInUserFollowingProfileUser: this.state.loggedInUserFollowingProfileUser,\n      clickFollowButton: this.clickFollowButton,\n      clickNewPost: this.clickNewPost,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 290,\n        columnNumber: 17\n      }\n    }), this.state.newPost && /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 303,\n        columnNumber: 21\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"outerNewPost\",\n      onMouseDown: this.clickOuterNewPost,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 304,\n        columnNumber: 25\n      }\n    }), /*#__PURE__*/React.createElement(NewPost, {\n      deviceId: this.state.deviceId,\n      accessToken: this.state.accessToken,\n      onMouseDown: () => {},\n      userName: name,\n      submitNewPost: this.submitNewPost,\n      handleLogInButton: this.handleLogInButton,\n      product: this.state.serverData.user.product,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 305,\n        columnNumber: 25\n      }\n    })), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"profilePageImgContainer\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 316,\n        columnNumber: 17\n      }\n    }, /*#__PURE__*/React.createElement(\"img\", {\n      className: \"profilePageImg\",\n      src: this.state.imgUrl ? this.state.imgUrl : profilePicturePlaceholder,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 317,\n        columnNumber: 21\n      }\n    })), /*#__PURE__*/React.createElement(\"h2\", {\n      className: \"profilePageUsername\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 319,\n        columnNumber: 17\n      }\n    }, this.state.profilePageUsername), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"profilePageContent\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 320,\n        columnNumber: 17\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"profilePageUser\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 321,\n        columnNumber: 21\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"followContainer\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 322,\n        columnNumber: 25\n      }\n    }, /*#__PURE__*/React.createElement(\"h2\", {\n      style: {\n        marginTop: 0\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 323,\n        columnNumber: 29\n      }\n    }, \"Followers: \", followers.length), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"scrollFollowers\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 324,\n        columnNumber: 29\n      }\n    }, followers.map(follower => /*#__PURE__*/React.createElement(FollowerLink, {\n      follow: follower,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 326,\n        columnNumber: 37\n      }\n    })))), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"followContainer\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 330,\n        columnNumber: 25\n      }\n    }, /*#__PURE__*/React.createElement(\"h2\", {\n      style: {\n        marginTop: 0\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 331,\n        columnNumber: 29\n      }\n    }, \"Following: \", following.length), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"scrollFollowing\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 332,\n        columnNumber: 29\n      }\n    }, following.map(following => /*#__PURE__*/React.createElement(FollowerLink, {\n      follow: following,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 334,\n        columnNumber: 37\n      }\n    }))))), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"profilePagePosts\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 339,\n        columnNumber: 21\n      }\n    }, allPosts.map(currentPost => /*#__PURE__*/React.createElement(\"div\", {\n      className: \"postContainer\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 341,\n        columnNumber: 29\n      }\n    }, currentPost.likedByProfilePageUser && /*#__PURE__*/React.createElement(\"p\", {\n      className: \"userProfileLikes\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 342,\n        columnNumber: 72\n      }\n    }, this.state.profilePageUsername, \" liked:\"), /*#__PURE__*/React.createElement(Post, {\n      post: currentPost,\n      deviceId: this.state.deviceId,\n      accessToken: this.state.accessToken,\n      muted: this.state.muted,\n      username: name,\n      product: this.state.serverData.user ? this.state.serverData.user.product : '',\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 343,\n        columnNumber: 33\n      }\n    }))))));\n  }\n\n}\n\nexport default UserProfile;\nexport class FollowerLink extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      imgUrl: '',\n      name: ''\n    };\n    this.redirectToUserProfile = this.redirectToUserProfile.bind(this);\n  }\n\n  componentWillReceiveProps() {\n    if (this.state.name !== this.props.follow.username) {\n      let parsed = queryString.parse(window.location.search);\n      let accessToken = '';\n\n      if (parsed.access_token) {\n        accessToken = parsed.access_token;\n        getUser(accessToken, this.props.follow.userId).then(user => {\n          let imgUrl = user.images ? user.images[0].url : '';\n          this.setState({\n            imgUrl: imgUrl\n          });\n        });\n      }\n    }\n  }\n\n  componentDidMount() {\n    let parsed = queryString.parse(window.location.search);\n    let accessToken = '';\n\n    if (parsed.access_token) {\n      accessToken = parsed.access_token;\n      getUser(accessToken, this.props.follow.userId).then(user => {\n        let imgUrl = user.images ? user.images[0].url : '';\n        this.setState({\n          imgUrl: imgUrl,\n          name: this.props.follow.username\n        });\n      });\n    }\n  }\n\n  redirectToUserProfile() {\n    let parsed = queryString.parse(window.location.search);\n    let accessToken = '';\n    if (parsed.access_token) accessToken = parsed.access_token;\n    window.location.href = window.location.origin + '/user/?username=' + this.props.follow.username + '&userId=' + this.props.follow.userId + (accessToken ? '&access_token=' + accessToken : '');\n  }\n\n  render() {\n    let name = this.props.follow.username;\n    return /*#__PURE__*/React.createElement(\"div\", {\n      className: \"followerLink\",\n      onClick: this.redirectToUserProfile,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 416,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(\"img\", {\n      src: this.state.imgUrl ? this.state.imgUrl : profilePicturePlaceholder,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 417,\n        columnNumber: 17\n      }\n    }), /*#__PURE__*/React.createElement(\"h3\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 418,\n        columnNumber: 17\n      }\n    }, name));\n  }\n\n}","map":{"version":3,"sources":["/Users/colepatton/Vibe-share/src/pages/UserProfile.js"],"names":["React","Component","queryString","loadPosts","loadLikes","loadUserFollowing","followUser","unFollowUser","newUser","getLoggedInUser","getUser","Post","profilePicturePlaceholder","ProfilePageHeader","NewPost","UserProfile","constructor","handlePlayerStatus","device_id","setState","deviceId","initializePlayer","name","state","serverData","user","player","window","Spotify","Player","getOAuthToken","cb","accessToken","addListener","message","console","error","log","connect","profilePageUsername","muted","followers","following","loggedInUserFollowingProfileUser","profilePicY","newPost","clickFollowButton","bind","unfollowUser","redirectToHomePage","handleMuteButton","clickNewPost","clickOuterNewPost","componentDidMount","parsed","parse","location","search","profilePageUsernameFromUrl","username","profilePageIDFromUrl","userId","postsForProfile","access_token","then","imgUrl","images","length","url","postProfilePic","display_name","userFollowing","Object","keys","id","profilePageUser","filter","f","posts","likes","forEach","post","likedByProfilePageUser","likeCount","like","_id","postId","push","product","profilePic","profilePageId","onSpotifyWebPlaybackSDKReady","updatedFollowerList","deleteIndex","findIndex","x","splice","href","origin","showPost","submitNewPost","text","songId","songName","songArtist","songArt","startTime","stopTime","submitPost","updatedPosts","unshift","render","allPosts","handleLogInButton","marginTop","map","follower","currentPost","FollowerLink","props","redirectToUserProfile","componentWillReceiveProps","follow"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport queryString from 'query-string';\nimport '../style/App.css';\nimport { loadPosts, loadLikes, loadUserFollowing, followUser, unFollowUser, newUser } from '../backendCalls'\nimport { getLoggedInUser, getUser } from '../spotifyCalls';\nimport Post from '../components/Post';\nimport profilePicturePlaceholder from '../img/profilePicturePlaceholder.jpg';\nimport ProfilePageHeader from '../components/ProfilePageHeader';\nimport NewPost from '../components/NewPost';\n\nclass UserProfile extends Component {\n    constructor() {\n        super();\n        this.state = {\n            deviceId: '',\n            accessToken: '',\n            profilePageUsername: '',\n            serverData: {},\n            muted: true,\n            followers: [],\n            following: [],\n            loggedInUserFollowingProfileUser: false,\n            profilePicY: '',\n            newPost: false\n        };\n        this.clickFollowButton = this.clickFollowButton.bind(this);\n        this.followUser = this.followUser.bind(this);\n        this.unfollowUser = this.unfollowUser.bind(this);\n        this.redirectToHomePage = this.redirectToHomePage.bind(this);\n        this.handleMuteButton = this.handleMuteButton.bind(this);\n        this.clickNewPost = this.clickNewPost.bind(this);\n        this.clickOuterNewPost = this.clickOuterNewPost.bind(this);\n    }\n    handlePlayerStatus = async (device_id) => {\n        this.setState({\n            deviceId: device_id,\n        });\n    };\n    initializePlayer = () => {\n        const name = this.state.serverData.user.name + ' vibes';\n\n        this.player = new window.Spotify.Player({\n            getOAuthToken: cb => {\n                cb(this.state.accessToken);\n            },\n            name\n        });\n\n        this.player.addListener('initialization_error', ({ message }) => { console.error(message); });\n        this.player.addListener('authentication_error', ({ message }) => { console.error(message); });\n        this.player.addListener('account_error', ({ message }) => { console.error(message); });\n        this.player.addListener('playback_error', ({ message }) => { console.error(message); });\n\n        // Playback status updates\n        this.player.addListener('player_state_changed', state => { console.log(state); });\n\n        // Ready\n        this.player.addListener('ready', ({ device_id }) => {\n            this.handlePlayerStatus(device_id);\n            console.log('Ready with Device ID', device_id);\n        });\n\n        // Not Ready\n        this.player.addListener('not_ready', ({ device_id }) => {\n            console.log('Device ID has gone offline', device_id);\n        });\n\n        this.player.connect();\n    };\n    componentDidMount() {\n        let parsed = queryString.parse(window.location.search);\n        let profilePageUsernameFromUrl = parsed.username;\n        let profilePageIDFromUrl = parsed.userId;\n        let postsForProfile = [];\n        if (parsed.access_token) {\n            let accessToken = parsed.access_token;\n            getUser(accessToken, profilePageIDFromUrl).then(user => {\n                let imgUrl = user.images && user.images.length > 0 ?\n                    user.images[0].url : '';\n                this.setState({\n                    imgUrl: imgUrl\n                });\n            });\n\n            getLoggedInUser(accessToken).then(user => {\n                let postProfilePic = user.images && user.images.length > 0 ?\n                user.images[0].url : '';\n\n                loadUserFollowing(user.display_name).then(userFollowing => {\n                    if (!Object.keys(userFollowing).length) {\n                        newUser(user.id, user.display_name);\n                    }\n                });\n                loadUserFollowing(profilePageIDFromUrl).then(profilePageUser => {\n                    let loggedInUserFollowingProfileUser = profilePageUser.followers &&\n                        profilePageUser.followers.filter(f =>\n                            f.username === user.display_name && f.userId === user.id).length > 0;\n                    this.setState({\n                        followers: profilePageUser.followers,\n                        following: profilePageUser.following,\n                        loggedInUserFollowingProfileUser: loggedInUserFollowingProfileUser,\n                        profilePicY: profilePageUser.profilePicY\n                    });\n                });\n\n                loadPosts().then(posts => {\n                    loadLikes().then(likes => {\n                        posts.forEach(post => {\n                            let likedByProfilePageUser = false;\n                            let likeCount = 0\n                            if (post.username === profilePageUsernameFromUrl) {\n                                likes.forEach(like => {\n                                    if (post._id === like.postId) {\n                                        likeCount++;\n                                    }\n                                });\n                                post = {\n                                    ...post,\n                                    likedByProfilePageUser: likedByProfilePageUser,\n                                    likeCount: likeCount\n                                }\n                                postsForProfile.push(post);\n                            } else {\n                                likes.forEach(like => {\n                                    if (post._id === like.postId) {\n                                        likeCount++;\n                                        if (like.username === profilePageUsernameFromUrl) {\n                                            post = {\n                                                ...post,\n                                                likedByProfilePageUser: true,\n                                                likeCount: likeCount\n                                            }\n                                            postsForProfile.push(post);\n                                        }\n                                    }\n                                });\n                            }\n                        });\n\n                        this.setState({\n                            accessToken: accessToken,\n                            serverData: {\n                                posts: postsForProfile,\n                                user: {\n                                    name: user.display_name,\n                                    product: user.product,\n                                    id: user.id,\n                                    profilePic: postProfilePic\n                                }\n                            },\n                            profilePageUsername: profilePageUsernameFromUrl,\n                            profilePageId: profilePageIDFromUrl,\n                        });\n                    }).then(window.onSpotifyWebPlaybackSDKReady = this.initializePlayer);\n                });\n            });\n        } else {\n            loadUserFollowing(profilePageIDFromUrl).then(user => {\n                this.setState({\n                    followers: user.followers,\n                    following: user.following,\n                    profilePicY: user.profilePicY\n                })\n            })\n\n            loadPosts().then(posts => {\n                loadLikes().then(likes => {\n                    posts.forEach(post => {\n                        let likeCount = 0\n                        if (post.username === profilePageUsernameFromUrl) {\n                            likes.forEach(like => {\n                                if (post._id === like.postId) {\n                                    likeCount++;\n                                }\n                            });\n                            post = {\n                                ...post,\n                                likedByProfilePageUser: false,\n                                likeCount: likeCount\n                            }\n                            postsForProfile.push(post);\n                        } else {\n                            likes.forEach(like => {\n                                if (post._id === like.postId) {\n                                    likeCount++;\n                                    if (like.username === profilePageUsernameFromUrl) {\n                                        post = {\n                                            ...post,\n                                            likedByProfilePageUser: true,\n                                            likeCount: likeCount\n                                        }\n                                        postsForProfile.push(post);\n                                    }\n                                }\n                            });\n                        }\n                    });\n                    this.setState({\n                        serverData: {\n                            posts: postsForProfile,\n                        },\n                        profilePageUsername: profilePageUsernameFromUrl,\n                        profilePageId: profilePageIDFromUrl\n                    });\n                });\n            });\n        }\n    }\n    unfollowUser() {\n        unFollowUser(this.state.serverData.user.name, this.state.serverData.user.id,\n            this.state.profilePageUsername, this.state.profilePageId);\n        const updatedFollowerList = this.state.followers;\n        const deleteIndex = updatedFollowerList.findIndex(x => x === this.state.serverData.user.id);\n        updatedFollowerList.splice(deleteIndex, 1);\n        this.setState({\n            followers: updatedFollowerList,\n            loggedInUserFollowingProfileUser: false\n        });\n    }\n    followUser() {\n        followUser(this.state.serverData.user.name, this.state.serverData.user.id,\n            this.state.profilePageUsername, this.state.profilePageId);\n        const updatedFollowerList = this.state.followers;\n        updatedFollowerList.push({\n            userId: this.state.serverData.user.id,\n            username: this.state.serverData.user.name\n        });\n        this.setState({\n            followers: updatedFollowerList,\n            loggedInUserFollowingProfileUser: true\n        });\n    }\n    clickFollowButton() {\n        this.state.loggedInUserFollowingProfileUser ? this.unfollowUser() : this.followUser();\n    }\n    redirectToHomePage() {\n        window.location.href = window.location.origin + (this.state.accessToken ? ('?access_token=' + this.state.accessToken) : '');\n    }\n    handleMuteButton() {\n        this.setState({ muted: !this.state.muted });\n    }\n    clickNewPost() {\n        const showPost = this.state.newPost;\n        this.setState({\n            newPost: !showPost\n        });\n    }\n    clickOuterNewPost() {\n        const showPost = this.state.newPost;\n        this.setState({\n            newPost: !showPost\n        });\n    }\n\n  async submitNewPost(text, songId, songName, songArtist, songArt, startTime, stopTime) {\n    const profilePic = this.state.imgUrl;\n    const username = this.state.serverData.user.name;\n    const userId = this.state.serverData.user.id;\n    const newPost = await submitPost(\n      profilePic,\n      username,\n      userId,\n      text,\n      songId,\n      songName,\n      songArtist,\n      songArt,\n      startTime,\n      stopTime\n    );\n    const updatedPosts = this.state.serverData.posts;\n    updatedPosts.unshift(newPost);\n    this.setState({\n      serverData: {\n        posts: updatedPosts,\n        user: this.state.serverData.user\n      },\n      newPost: false\n    });\n  }\n\n    render() {\n        let allPosts = this.state.serverData.posts ? this.state.serverData.posts : [];\n        let followers = this.state.followers ? this.state.followers : [];\n        let following = this.state.following ? this.state.following : [];\n        let name = this.state.serverData.user ? this.state.serverData.user.name : 'Not logged in';\n        let userId = this.state.serverData.user ? this.state.serverData.user.id : '';\n        return (\n            <div className='App'>\n                <ProfilePageHeader\n                    username={name}\n                    userId={userId}\n                    handleMuteButton={this.handleMuteButton}\n                    muted={this.state.muted}\n                    profilePic={this.state.imgUrl}\n                    profilePicY={this.state.profilePicY}\n                    profilePageId={this.state.profilePageId}\n                    loggedInUserFollowingProfileUser={this.state.loggedInUserFollowingProfileUser}\n                    clickFollowButton={this.clickFollowButton}\n                    clickNewPost={this.clickNewPost}\n                />\n                {this.state.newPost &&\n                    <div>\n                        <div className=\"outerNewPost\" onMouseDown={this.clickOuterNewPost}></div>\n                        <NewPost\n                            deviceId={this.state.deviceId}\n                            accessToken={this.state.accessToken}\n                            onMouseDown={() => { }}\n                            userName={name}\n                            submitNewPost={this.submitNewPost}\n                            handleLogInButton={this.handleLogInButton}\n                            product={this.state.serverData.user.product}\n                        />\n                    </div>\n                }\n                <div className='profilePageImgContainer'>\n                    <img className='profilePageImg' src={this.state.imgUrl ? this.state.imgUrl : profilePicturePlaceholder} />\n                </div>\n                <h2 className='profilePageUsername'>{this.state.profilePageUsername}</h2>\n                <div className='profilePageContent'>\n                    <div className='profilePageUser'>\n                        <div className='followContainer'>\n                            <h2 style={{ marginTop: 0 }}>Followers: {followers.length}</h2>\n                            <div className='scrollFollowers'>\n                                {followers.map(follower =>\n                                    <FollowerLink follow={follower} />\n                                )}\n                            </div>\n                        </div>\n                        <div className='followContainer'>\n                            <h2 style={{ marginTop: 0 }}>Following: {following.length}</h2>\n                            <div className='scrollFollowing'>\n                                {following.map(following =>\n                                    <FollowerLink follow={following} />\n                                )}\n                            </div>\n                        </div>\n                    </div>\n                    <div className='profilePagePosts'>\n                        {allPosts.map(currentPost =>\n                            <div className='postContainer'>\n                                {currentPost.likedByProfilePageUser && <p className=\"userProfileLikes\">{this.state.profilePageUsername} liked:</p>}\n                                <Post\n                                    post={currentPost}\n                                    deviceId={this.state.deviceId}\n                                    accessToken={this.state.accessToken}\n                                    muted={this.state.muted}\n                                    username={name}\n                                    product={this.state.serverData.user ? this.state.serverData.user.product : ''}\n                                />\n                            </div>\n                        )}\n                    </div>\n                </div>\n            </div >\n        )\n    }\n}\n\nexport default UserProfile;\n\nexport class FollowerLink extends Component {\n    constructor(props) {\n        super(props);\n        this.state = {\n            imgUrl: '',\n            name: '',\n        };\n        this.redirectToUserProfile = this.redirectToUserProfile.bind(this);\n    }\n    componentWillReceiveProps() {\n        if (this.state.name !== this.props.follow.username) {\n            let parsed = queryString.parse(window.location.search);\n            let accessToken = ''\n            if (parsed.access_token) {\n                accessToken = parsed.access_token;\n                getUser(accessToken, this.props.follow.userId).then(user => {\n                    let imgUrl = user.images ?\n                        user.images[0].url : '';\n                    this.setState({\n                        imgUrl: imgUrl,\n                    });\n                });\n            }\n        }\n    }\n    componentDidMount() {\n        let parsed = queryString.parse(window.location.search);\n        let accessToken = ''\n        if (parsed.access_token) {\n            accessToken = parsed.access_token;\n            getUser(accessToken, this.props.follow.userId).then(user => {\n                let imgUrl = user.images ?\n                    user.images[0].url : '';\n                this.setState({\n                    imgUrl: imgUrl,\n                    name: this.props.follow.username\n                });\n            });\n        }\n    }\n    redirectToUserProfile() {\n        let parsed = queryString.parse(window.location.search);\n        let accessToken = ''\n        if (parsed.access_token)\n            accessToken = parsed.access_token;\n\n        window.location.href = window.location.origin +\n            '/user/?username=' + this.props.follow.username +\n            '&userId=' + this.props.follow.userId +\n            (accessToken ? ('&access_token=' + accessToken) : '');\n    }\n    render() {\n        let name = this.props.follow.username;\n        return (\n            <div className=\"followerLink\" onClick={this.redirectToUserProfile}>\n                <img src={this.state.imgUrl ? this.state.imgUrl : profilePicturePlaceholder}></img>\n                <h3>{name}</h3>\n            </div>\n        );\n    }\n}"]},"metadata":{},"sourceType":"module"}